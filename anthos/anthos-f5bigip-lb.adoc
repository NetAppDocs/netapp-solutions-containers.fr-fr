---
sidebar: sidebar 
permalink: anthos/anthos-f5bigip-lb.html 
summary: 'F5 BIG-IP est un contrôleur de distribution d"applications (ADC) qui offre un large ensemble de services avancés de gestion du trafic et de sécurité de niveau production, tels que l"équilibrage de charge L4-L7, le déchargement SSL/TLS, le DNS, le pare-feu et bien d"autres.  Ces services augmentent considérablement la disponibilité, la sécurité et les performances de vos applications.' 
keywords: Anthos, GKE, Kubernetes, F5, BigIP, LoadBalancer 
---
= Installation des équilibreurs de charge F5 BIG-IP
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
F5 BIG-IP est un contrôleur de distribution d'applications (ADC) qui offre un large ensemble de services avancés de gestion du trafic et de sécurité de niveau production, tels que l'équilibrage de charge L4-L7, le déchargement SSL/TLS, le DNS, le pare-feu, etc.  Ces services augmentent considérablement la disponibilité, la sécurité et les performances de vos applications.

F5 BIG-IP peut être déployé et consommé de différentes manières, notamment sur du matériel dédié, dans le cloud ou en tant qu'appliance virtuelle sur site.  Reportez-vous à la documentation ici pour explorer et déployer F5 BIG-IP.

F5 BIG-IP a été la première des solutions d'équilibrage de charge groupées disponibles avec Anthos On-Prem et a été utilisée dans un certain nombre des premières validations de partenaires Anthos Ready pour la solution Anthos avec NetApp .


NOTE: F5 BIG-IP peut être déployé en mode autonome ou en mode cluster.  Aux fins de cette validation, F5 BIG-IP a été déployé en mode autonome.  Cependant, à des fins de production, NetApp recommande de créer un cluster d'instances BIG-IP pour éviter un point de défaillance unique.


NOTE: Un système F5 BIG-IP peut être déployé sur du matériel dédié, dans le cloud ou en tant qu'appliance virtuelle sur site avec des versions supérieures à 12.x pour être intégré à F5 CIS.  Aux fins du présent document, le système F5 BIG-IP a été validé en tant qu'appareil virtuel, par exemple à l'aide de l'édition BIG-IP VE.



== Versions validées

Cette solution utilise l’appliance virtuelle déployée dans VMware vSphere.  La mise en réseau de l'appliance virtuelle F5 Big-IP peut être configurée dans une configuration à deux ou trois bras en fonction de votre environnement réseau.  Le déploiement dans ce document est basé sur la configuration à deux bras.  Des détails supplémentaires sur la configuration de l'appliance virtuelle à utiliser avec Anthos sont disponibles. https://cloud.google.com/solutions/partners/installing-f5-big-ip-adc-for-gke-on-prem["ici"] .

L'équipe d'ingénierie des solutions de NetApp a validé les versions du tableau suivant dans notre laboratoire pour fonctionner avec les déploiements d'Anthos On-Prem :

|===


| Faire | Type | Version 


| F5 | BIG-IP VE | 15.0.1-0.0.11 


| F5 | BIG-IP VE | 16.1.0-0.0.19 
|===


== Installation

Pour installer F5 BIG-IP, procédez comme suit :

. Téléchargez le fichier Open Virtual Appliance (OVA) de l'application virtuelle à partir de F5 https://downloads.f5.com/esd/serveDownload.jsp?path=/big-ip/big-ip_v15.x/15.0.1/english/virtual-edition/&sw=BIG-IP&pro=big-ip_v15.x&ver=15.0.1&container=Virtual-Edition&file=BIGIP-15.0.1-0.0.11.ALL-vmware.ova["ici"] .
+

NOTE: Pour télécharger l'appareil, un utilisateur doit s'inscrire avec F5.  Ils fournissent une licence de démonstration de 30 jours pour l'équilibreur de charge Big-IP Virtual Edition.  NetApp recommande une licence permanente de 10 Gbit/s pour le déploiement en production d'un appareil.

. Cliquez avec le bouton droit sur le pool de ressources d’infrastructure et sélectionnez Déployer le modèle OVF.  Un assistant se lance et vous permet de sélectionner le fichier OVA que vous venez de télécharger à l'étape 1.  Cliquez sur Suivant.
+
image:deploy-big-ip-001.png["Déployer un appareil Big-IP"]

. Cliquez sur Suivant pour continuer chaque étape et acceptez les valeurs par défaut pour chaque écran présenté jusqu'à ce que vous atteigniez l'écran de sélection de stockage.  Sélectionnez le VM_Datastore sur lequel vous souhaitez déployer la machine virtuelle, puis cliquez sur Suivant.
. L'écran suivant présenté par l'assistant vous permet de personnaliser les réseaux virtuels à utiliser dans l'environnement.  Sélectionnez VM_Network pour le champ Externe et sélectionnez Management_Network pour le champ Gestion.  Les configurations internes et HA sont utilisées pour les configurations avancées de l'appliance F5 Big-IP et ne sont pas configurées.  Ces paramètres peuvent être laissés tels quels ou configurés pour se connecter à des groupes de ports distribués non infrastructurels.  Cliquez sur Suivant.
+
image:deploy-big-ip-002.png["Déployer l'appliance Big_IP, partie 2"]

. Consultez l’écran récapitulatif de l’appliance et, si toutes les informations sont correctes, cliquez sur Terminer pour démarrer le déploiement.
. Une fois l’appliance virtuelle déployée, cliquez dessus avec le bouton droit de la souris et mettez-la sous tension.  Il devrait recevoir une adresse DHCP sur le réseau de gestion.  L'appareil est basé sur Linux et VMware Tools est déployé, vous pouvez donc afficher l'adresse DHCP qu'il reçoit dans le client vSphere.
+
image:deploy-big-ip-003.png["Déployer un appareil Big-IP, partie 3"]

. Ouvrez un navigateur Web et connectez-vous à l’appareil à l’adresse IP de l’étape précédente.  La connexion par défaut est admin/admin et, après la première connexion, l'appareil vous invite immédiatement à modifier le mot de passe administrateur.  Vous êtes ensuite redirigé vers un écran où vous devez vous connecter avec les nouvelles informations d'identification.
+
image:big-ip-config-001.png["Configuration Big-IP"]

. Le premier écran invite l’utilisateur à terminer l’utilitaire de configuration.  Démarrez l’utilitaire en cliquant sur Suivant.
+
image:big-ip-config-002.png["Configuration Big-IP, partie 2"]

. L'écran suivant demande l'activation de la licence de l'appareil.  Cliquez sur Activer pour commencer.  Lorsque vous y êtes invité sur la page suivante, collez soit la clé de licence d'évaluation de 30 jours que vous avez reçue lors de votre inscription au téléchargement, soit la licence permanente que vous avez acquise lors de l'achat de l'appareil.  Cliquez sur Suivant.
+
image:big-ip-config-003.png["Configuration Big-IP, partie 3"]

+

NOTE: Pour que l'appareil puisse effectuer l'activation, le réseau défini sur l'interface de gestion doit pouvoir accéder à Internet.

. Sur l’écran suivant, le contrat de licence utilisateur final (CLUF) est présenté.  Si les termes de la licence sont acceptables, cliquez sur Accepter.
. L'écran suivant compte le temps écoulé pendant qu'il vérifie les modifications de configuration qui ont été effectuées jusqu'à présent.  Cliquez sur Continuer pour reprendre la configuration initiale.
+
image:big-ip-config-004.png["Configuration Big-IP, partie 4"]

. La fenêtre Modification de la configuration se ferme et l'utilitaire de configuration affiche le menu Provisionnement des ressources.  Cette fenêtre répertorie les fonctionnalités actuellement sous licence et les allocations de ressources actuelles pour l'appliance virtuelle et chaque service en cours d'exécution.
+
image:big-ip-config-005.png["Configuration Big-IP, partie 5"]

. Cliquer sur l'option de menu Plateforme sur la gauche permet une modification supplémentaire de la plateforme.  Les modifications incluent la définition de l'adresse IP de gestion configurée avec DHCP, la définition du nom d'hôte et du fuseau horaire dans lequel l'appliance est installée, ainsi que la sécurisation de l'appliance contre l'accessibilité SSH.
+
image:big-ip-config-006.png["Configuration Big-IP, partie 6"]

. Cliquez ensuite sur le menu Réseau, qui vous permet de configurer les fonctionnalités réseau standard.  Cliquez sur Suivant pour démarrer l’assistant de configuration réseau standard.
+
image:big-ip-config-007.png["Configuration Big-IP, partie 7"]

. La première page de l’assistant configure la redondance ; laissez les valeurs par défaut et cliquez sur Suivant.  La page suivante vous permet de configurer une interface interne sur l’équilibreur de charge.  L'interface 1.1 est mappée sur la VMNIC étiquetée Interne dans l'assistant de déploiement OVF.
+
image:big-ip-config-008.png["Configuration Big-IP, partie 8"]

+

NOTE: Les espaces de cette page pour l'adresse IP personnelle, le masque de réseau et l'adresse IP flottante peuvent être remplis avec une adresse IP non routable à utiliser comme espace réservé.  Ils peuvent également être remplis d'un réseau interne qui a été configuré comme un groupe de ports distribués pour les invités virtuels si vous déployez la configuration à trois bras.  Ils doivent être complétés pour continuer avec l'assistant.

. La page suivante vous permet de configurer un réseau externe utilisé pour mapper les services aux pods déployés dans Kubernetes.  Sélectionnez une adresse IP statique dans la plage VM_Network, le masque de sous-réseau approprié et une adresse IP flottante dans cette même plage.  L'interface 1.2 est mappée sur la VMNIC étiquetée Externe dans l'assistant de déploiement OVF.
+
image:big-ip-config-009.png["Configuration Big-IP, partie 9"]

. Sur la page suivante, vous pouvez configurer un réseau HA interne si vous déployez plusieurs appliances virtuelles dans l’environnement.  Pour continuer, vous devez remplir les champs Adresse IP automatique et Masque de réseau, et vous devez sélectionner l'interface 1.3 comme interface VLAN, qui correspond au réseau HA défini par l'assistant de modèle OVF.
+
image:big-ip-config-010.png["Configuration Big-IP, partie 10"]

. La page suivante vous permet de configurer les serveurs NTP.  Cliquez ensuite sur Suivant pour continuer la configuration DNS.  Les serveurs DNS et la liste de recherche de domaine doivent déjà être renseignés par le serveur DHCP.  Cliquez sur Suivant pour accepter les valeurs par défaut et continuer.
. Pour le reste de l'assistant, cliquez sur Suivant pour continuer la configuration avancée du peering, dont la configuration dépasse le cadre de ce document.  Cliquez ensuite sur Terminer pour quitter l’assistant.
. Créez des partitions individuelles pour le cluster d’administrateur Anthos et chaque cluster d’utilisateurs déployé dans l’environnement.  Cliquez sur Système dans le menu de gauche, accédez à Utilisateurs et cliquez sur Liste des partitions.
+
image:big-ip-config-011.png["Configuration Big-IP, partie 11"]

. L'écran affiché montre uniquement la partition commune actuelle.  Cliquez sur Créer à droite pour créer la première partition supplémentaire et nommez-la `GKE-Admin` .  Cliquez ensuite sur Répéter et nommez la partition `User-Cluster-1` .  Cliquez à nouveau sur le bouton Répéter pour nommer la partition suivante `User-Cluster-2` .  Enfin, cliquez sur Terminé pour terminer l’assistant.  L'écran de la liste des partitions revient avec toutes les partitions désormais répertoriées.
+
image:big-ip-config-012.png["Configuration Big-IP, partie 12"]





== Intégration avec Anthos

Il existe une section dans chaque fichier de configuration, respectivement pour le cluster d'administrateur et chaque cluster d'utilisateur que vous choisissez de déployer pour configurer l'équilibreur de charge afin qu'il soit géré par Anthos On Prem.

Le script suivant est un exemple de configuration de la partition pour le cluster GKE-Admin.  Les valeurs qui doivent être décommentées et modifiées sont placées en gras ci-dessous :

[listing, subs="+quotes,+verbatim"]
----
# (Required) Load balancer configuration
*loadBalancer:*
  # (Required) The VIPs to use for load balancing
  *vips:*
    # Used to connect to the Kubernetes API
    *controlPlaneVIP: "10.61.181.230"*
    # # (Optional) Used for admin cluster addons (needed for multi cluster features). Must
    # # be the same across clusters
    # # addonsVIP: ""
  # (Required) Which load balancer to use "F5BigIP" "Seesaw" or "ManualLB". Uncomment
  # the corresponding field below to provide the detailed spec
  *kind: F5BigIP*
  # # (Required when using "ManualLB" kind) Specify pre-defined nodeports
  # manualLB:
  #   # NodePort for ingress service's http (only needed for user cluster)
  #   ingressHTTPNodePort: 0
  #   # NodePort for ingress service's https (only needed for user cluster)
  #   ingressHTTPSNodePort: 0
  #   # NodePort for control plane service
  #   controlPlaneNodePort: 30968
  #   # NodePort for addon service (only needed for admin cluster)
  #   addonsNodePort: 31405
  # # (Required when using "F5BigIP" kind) Specify the already-existing partition and
  # # credentials
  *f5BigIP:*
    *address: "172.21.224.21"*
    *credentials:*
      *username: "admin"*
      *password: "admin-password"*
    *partition: "GKE-Admin"*
  #   # # (Optional) Specify a pool name if using SNAT
  #   # snatPoolName: ""
  # (Required when using "Seesaw" kind) Specify the Seesaw configs
  # seesaw:
    # (Required) The absolute or relative path to the yaml file to use for IP allocation
    # for LB VMs. Must contain one or two IPs.
    #  ipBlockFilePath: ""
    # (Required) The Virtual Router IDentifier of VRRP for the Seesaw group. Must
    # be between 1-255 and unique in a VLAN.
    #  vrid: 0
    # (Required) The IP announced by the master of Seesaw group
    #  masterIP: ""
    # (Required) The number CPUs per machine
    #  cpus: 4
    # (Required) Memory size in MB per machine
    #   memoryMB: 8192
    # (Optional) Network that the LB interface of Seesaw runs in (default: cluster
    # network)
    #   vCenter:
      # vSphere network name
      #     networkName: VM_Network
    # (Optional) Run two LB VMs to achieve high availability (default: false)
    #   enableHA: false
----